{% extends "base.html" %}
{% block title %}–û—Ç—á–µ—Ç—ã - ErespondentN{% endblock %}
{% block content %}

<div class="report-area_page">
    <div class="report-area_menu">
        <div class="report-area_podmenu">
            <div class="content-podmenu">
                <nav>
                    <ul>
                        <section>
                            <div class="functions_menu">
                                <li id = "link_add_report">
                                    <img src="{{ url_for('static', filename='img/icon_new_file.png') }}" alt="–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç">
                                    <a>–ù–æ–≤—ã–π</a>
                                </li>
                            </div>
                            <a class="functions_menu_name">
                                –û—Ç—á–µ—Ç
                            </a>
                        </section>
                        <section>
                            <div class="functions_menu"> 
                                <form id="control-version-form" method="POST" style="display: none;">
                                </form>
                                <li id="control_versionButton">
                                    <img src="{{ url_for('static', filename='img/icon_control.png') }}" alt="">
                                    <a>–ö–æ–Ω—Ç—Ä–æ–ª—å</a>
                                </li>
                                <form id="agreed-version-form" method="POST" style="display: none;">
                                    
                                </form>
                                <li id = "agreedVersionButton">
                                    <img src="{{ url_for('static', filename='img/icon_galochka.png') }}" alt="">
                                    <a>–°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å</a>
                                </li>
                                <li id = "sentVersionButton">
                                    <img src="{{ url_for('static', filename='img/icon_send.png') }}" alt="">
                                    <a>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</a>
                                </li>
                            </div>
                            <a class="functions_menu_name">
                                C—Ç–∞—Ç—É—Å
                            </a>
                        </section>
                        <section>
                            <div class="functions_menu">
                                <form id="export-version-form" action="/export-version/{{current_version}}" method="POST" style="display: none;">
                                </form>    
                                <li id="export_versionButton">
                                    <img src="{{ url_for('static', filename='img/icon_excel.png') }}" alt="">
                                    <a>Excel</a>
                                </li>
                            </div>
                            <a class="functions_menu_name">
                                –≠–∫—Å–ø–æ—Ä—Ç
                            </a>
                        </section>

                        {#<section>
                            <div class="functions_menu">
                                <li id = "PrintTicketButton">
                                    <img src="{{ url_for('static', filename='img/icon_print_file.png') }}" alt="">
                                    <a>–ü–µ—á–∞—Ç—å</a>
                                </li>
                                <form id="print-ticket-form" action="/print_ticket" method="POST" style="display: none;">
                                </form>
                            </div>
                            <a class="functions_menu_name">
                                –ö–≤–∏—Ç–∞–Ω—Ü–∏—è
                            </a>
                        </section>#}
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <div class="report-area" >
        <table class="table-report-area">
            <thead class="table-title">
                <tr>
                    <th></th>
                    <th style = "white-space: nowrap;"></th>
                    <th class="resizable" style="min-width: 120px;">–û–ö–ü–û<div class="resizer"></div></th>
                    <th class="resizable" style="white-space: nowrap; min-width: 320px;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è<div class="resizer"></div></th>
                    <th class="resizable" style="min-width: 80px;">–ì–æ–¥<div class="resizer"></div></th>
                    <th class="resizable" style="min-width: 80px;">–ö–≤–∞—Ä—Ç–∞–ª<div class="resizer"></div></th>
                    <th class="resizable" style="min-width: 140px;">–°—Ç–∞—Ç—É—Å<div class="resizer"></div></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {%if report%}
                    {% for row in report %}
                    <tr class="report_row" data-id="{{ row.id }}" data-version-id="{{ row.versions[0].id }}">
                        <td></td>
                        <td style = "padding: 4px;">
                            <button class="open-report-btn" onclick="window.location.href='/report-area/fuel/{{row.versions[0].id}}'">  
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                                <span>–ü—Ä–æ—Å–º–æ—Ç—Ä</span>
                            </button>
                        </td>
                        <td style = "display: none;">
                            <input type = "text" id = "report_id" value = "{{ row.id }}" readonly>
                        </td>
                        <td>
                            <input type = "text" id = "report_okpo" value = "{{ row.okpo }}" readonly>
                        </td>
                        <td>
                            <input type = "text" id = "report_organization_name" value = "{{ row.organization.full_name }}" readonly>
                        </td>
                        <td>
                            <input type = "text" id = "report_year" value = "{{ row.year }}" readonly>
                        </td>
                        <td>
                            <input type = "text" id = "report_quarter" value = "{{ row.quarter }}" readonly>
                        </td>
                        {% set version = row.versions[0] if row.versions else None %}
                        {% set style_control_passed = 'background: rgb(96, 255, 228);' %}
                        {% set style_approved = 'background: rgb(152, 255, 169);' %}
                        {% set style_sent = 'background: rgb(96, 215, 255);' %}
                        {% set style_comments = 'background: rgb(255, 186, 96);' %}
                        {% set style_ready_delete = 'background: rgb(255, 96, 96);' %}
                        {% set style_confirmed = 'background: rgb(96, 255, 122);' %}
                        {% set style_filling = 'background: rgb(236, 236, 236);' %}
                        {% set style_default = 'background: transparent;' %}

                        {% set input_style = 'color: black;' %}
                        {% set input_style_bold = 'color: black; font-weight: 600;' %}

                        {% if version %}
                            {% if version.status == '–ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ–π–¥–µ–Ω' %}
                                <td style="{{ style_control_passed }}">
                                    <input type="text" style="{{ input_style }}" value="{{ version.status }}" readonly>
                                </td>
                            {% elif version.status == '–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ' %}
                                <td style="{{ style_approved }}">
                                    <input type="text" style="{{ input_style }}" value="{{ version.status }}" readonly>
                                </td>
                            {% elif version.status == '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω' %}
                                <td style="{{ style_sent }}">
                                    <input type="text" style="{{ input_style }}" value="–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏" readonly>
                                </td>
                            {% elif version.status == '–ï—Å—Ç—å –∑–∞–º–µ—á–∞–Ω–∏—è' %}
                                <td style="{{ style_comments }}">
                                    <input type="text" style="{{ input_style }}" value="{{ version.status }}" readonly>
                                </td>
                            {% elif version.status == '–ì–æ—Ç–æ–≤ –∫ —É–¥–∞–ª–µ–Ω–∏—é' %}
                                <td style="{{ style_ready_delete }}">
                                    <input type="text" style="{{ input_style }}" value="{{ version.status }}" readonly>
                                </td>
                            {% elif version.status == '–û–¥–æ–±—Ä–µ–Ω' %}
                                <td style="{{ style_confirmed }}">
                                    <input type="text" style="{{ input_style }}" value="–û–¥–æ–±—Ä–µ–Ω" readonly>
                                </td>
                            {% elif version.status == '–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ' %}
                                <td style="{{ style_filling }}">
                                    <input type="text" style="{{ input_style_bold }}" value="–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ" readonly>
                                </td>
                            {% else %}
                                <td style="{{ style_default }}">
                                    <input type="text" style="{{ input_style }}" value="{{ version.status }}" readonly>
                                </td>
                            {% endif %}
                        {% else %}
                        {% endif %}
                        <td></td>
                    </tr>
                {% endfor %}
            {%else%}
                <tr>
                    <td></td>
                    <td></td>
                    <td style = "height: 24px;" colspan="6">
                        <input type = "text"  value = "–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –æ—Ç—á–µ—Ç" readonly>
                    </td>
                </tr>
            {%endif%}
            </tbody>
        </table>
    </div>
</div>

<div id="add_report_modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="change-position">–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞</h3>
            <img src="/static/img/Close.svg" id="close_add_report_modal" class="close" alt="">
        </div>
        <div class="answer-highlight-second">
            <div class="highlight-icon">üí°</div>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π <strong>–æ—Ç—á–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥</strong>.</p>
        </div>
        <form method="POST" action="/create-new-report">
            <input type="hidden" name="modal_add_year" id="selected-year-add" value="{{previous_year}}">
            <input type="hidden" name="modal_add_quarter" id="selected-quarter-add" value="{{previous_quarter}}">

            <div class="period-selector-advanced" id="add-period-selector">
                <div class="selector-card">
                    <div class="selector-grid">
                        <div class="year-wheel">
                            <button type="button" class="year-arrow up-arrow">‚Üë</button>
                            <div class="year-display"></div>
                            <button type="button" class="year-arrow down-arrow">‚Üì</button>
                        </div>
                        
                        <div class="quarter-grid">
                            <button type="button" class="q-cell" data-q="1">
                                <span class="q-number">1 –∫–≤.</span>
                                <span class="q-months">–Ø–Ω–≤-–ú–∞—Ä</span>
                            </button>
                            <button type="button" class="q-cell" data-q="2">
                                <span class="q-number">2 –∫–≤.</span>
                                <span class="q-months">–ê–ø—Ä-–ò—é–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="3">
                                <span class="q-number">3 –∫–≤.</span>
                                <span class="q-months">–ò—é–ª-–°–µ–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="4">
                                <span class="q-number">4 –∫–≤.</span>
                                <span class="q-months">–û–∫—Ç-–î–µ–∫</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="selector-info-add" class="period-info"></div>
            
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="model_but_area right">
                <button type="submit" class="blue_btn">
                    <img src="/static/img/Add.svg" alt="" class="button-icon">
                    <span>–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç</span>
                </button>
            </div>
        </form> 
    </div>
</div>

<div id="change_period_report_modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="change-position">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –æ—Ç—á–µ—Ç–∞</h3>
            <img src="{{ url_for('static', filename='img/Close.svg')}}" class="close" id="close_change_period_report_modal" alt="">
        </div>
       
        <div class="answer-highlight-second">
            <div class="highlight-icon">üí°</div>    
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π <strong>–æ—Ç—á–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥</strong>.</p>
        </div>
        <form method="POST" action="/change-period-report">
            <input type="hidden" name="modal_change_report_year" id="selected-year-change" value="">
            <input type="hidden" name="modal_change_report_quarter" id="selected-quarter-change" value="">
            <input type="hidden" name="modal_change_report_id" id="modal_change_report_id"  readonly>

            <div class="period-selector-advanced" id="change-period-selector">
                <div class="selector-card">
                    <div class="selector-grid">
                        <div class="year-wheel">
                            <button type="button" class="year-arrow up-arrow">‚Üë</button>
                            <div class="year-display"></div>
                            <button type="button" class="year-arrow down-arrow">‚Üì</button>
                        </div>
                        
                        <div class="quarter-grid">
                            <button type="button" class="q-cell" data-q="1">
                                <span class="q-number">1 –∫–≤.</span>
                                <span class="q-months">–Ø–Ω–≤-–ú–∞—Ä</span>
                            </button>
                            <button type="button" class="q-cell" data-q="2">
                                <span class="q-number">2 –∫–≤.</span>
                                <span class="q-months">–ê–ø—Ä-–ò—é–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="3">
                                <span class="q-number">3 –∫–≤.</span>
                                <span class="q-months">–ò—é–ª-–°–µ–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="4">
                                <span class="q-number">4 –∫–≤.</span>
                                <span class="q-months">–û–∫—Ç-–î–µ–∫</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="selector-info-change" class="period-info"></div>

            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="model_but_area right">
                <button type="submit" class="blue_btn">
                    <img src="/static/img/Edit.svg" alt="" class="button-icon">
                    <span>–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>
                </button>
            </div>
        </form> 
    </div>
</div>

<div id="copy_report_modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="change-position">–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞</h3>
            <img src="{{ url_for('static', filename='img/Close.svg')}}" class="close" alt="">
        </div>
        <div class="answer-highlight-second" style="max-width: 550px;">
            <div class="highlight-icon">üí°</div>
            <p>
                <strong>–û–±—ã—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</strong> ‚Äî —Å–æ–∑–¥–∞–µ—Ç —Ç–æ—á–Ω—É—é –∫–æ–ø–∏—é –æ—Ç—á–µ—Ç–∞ —Å–æ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏.<br>
                <strong>–ù–µ–ø–æ–ª–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</strong> ‚Äî –∫–æ–ø–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∏–¥—ã –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –±–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
            </p>
        </div>
        
        <form method="POST" id="copy-report-form">
            <input type="hidden" name="modal_copy_report_year" id="selected-year-copy">
            <input type="hidden" name="modal_copy_report_quarter" id="selected-quarter-copy">
            <input type="hidden" name="modal_copy_report_id" id="modal_copy_report_id" readonly>
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <div class="period-selector-advanced" id="copy-period-selector">
                <div class="selector-card">
                    <div class="selector-grid">
                        <div class="year-wheel">
                            <button type="button" class="year-arrow up-arrow">‚Üë</button>
                            <div class="year-display"></div>
                            <button type="button" class="year-arrow down-arrow">‚Üì</button>
                        </div>
                        
                        <div class="quarter-grid">
                            <button type="button" class="q-cell" data-q="1">
                                <span class="q-number">1 –∫–≤.</span>
                                <span class="q-months">–Ø–Ω–≤-–ú–∞—Ä</span>
                            </button>
                            <button type="button" class="q-cell" data-q="2">
                                <span class="q-number">2 –∫–≤.</span>
                                <span class="q-months">–ê–ø—Ä-–ò—é–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="3">
                                <span class="q-number">3 –∫–≤.</span>
                                <span class="q-months">–ò—é–ª-–°–µ–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="4">
                                <span class="q-number">4 –∫–≤.</span>
                                <span class="q-months">–û–∫—Ç-–î–µ–∫</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="selector-info-copy" class="period-info"></div>

            <div class="model_but_area">
                <button type="submit" formaction="/copy-full-report" class="blue_btn">
                    <img src="/static/img/Copy.svg" alt="" class="button-icon">
                    <span>–û–±—ã—á–Ω–∞—è –∫–æ–ø–∏—è</span>
                </button>
                <button type="submit" formaction="/copy-structure-report" class="blue_btn_invizback">
                    <span>–ù–µ–ø–æ–ª–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                </button>
            </div>
        </form> 
    </div>
</div>

<div id="contextMenu_report" class="white-panel">
    <button id = "link_change_report">
        <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
        </svg>
        <span>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥</span>
    </button>
    <button id = "link_coppy_report">
        <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
        </svg>
        <span>–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞</span>
    </button>
    <form id="deleteReport" method="POST" action="/delete-report/">
        <button type="submit" id="del_reportButton">
            <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
            <span>–£–¥–∞–ª–∏—Ç—å</span>
        </button>
    </form>
</div>
{% endblock %}
