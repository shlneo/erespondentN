{% extends "base.html" %}
{% block title %}–û—Ç—á–µ—Ç—ã - ErespondentN{% endblock %}
{% block content %}

<div class="report-area_page">
    <div class="report-area-menu">
        <div class="report-area_podmenu">
            <div class="content-podmenu">
                <nav>
                    <ul>
                        <section>
                            <div class="functions_menu">
                                <li id="link_add_report" class="{% if not report %}need-to-touch{% endif %}">
                                    <img src="{{ url_for('static', filename='img/icon_new_file.png') }}" alt="–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç">
                                    <a class = "li-title">
                                        <span>–ù–æ–≤—ã–π</span>
                                    </a>
                                </li>
                            </div>
                            <a class="functions_menu_name">
                                –û—Ç—á–µ—Ç
                            </a>
                        </section>
                        <section>
                            <div class="functions_menu"> 
                                <form id="control-version-form" method="POST" style="display: none;">
                                </form>
                                <li id="control_versionButton">
                                    <img src="{{ url_for('static', filename='img/icon_control.png') }}" alt="">
                                    <a class = "li-title">
                                        <span>–ö–æ–Ω—Ç—Ä–æ–ª—å</span>
                                    </a>
                                </li>
                                <form id="agreed-version-form" method="POST" style="display: none;">
                                    
                                </form>
                                <li id = "agreedVersionButton">
                                    <img src="{{ url_for('static', filename='img/icon_galochka.png') }}" alt="">
                                    <a class = "li-title">
                                        <span>–°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å</span>
                                    </a>
                                </li>
                                <li id = "sentVersionButton">
                                    <img src="{{ url_for('static', filename='img/icon_send.png') }}" alt="">
                                    <a class = "li-title">
                                        <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</span>
                                    </a>
                                </li>
                            </div>
                            <a class="functions_menu_name">
                                C—Ç–∞—Ç—É—Å
                            </a>
                        </section>
                        <section>
                            <div class="functions_menu">
                                <form id="export-version-form" action="/export-version/{{current_version}}" method="POST" style="display: none;">
                                </form>    
                                <li id="export_versionButton">
                                    <img src="{{ url_for('static', filename='img/icon_excel.png') }}" alt="">
                                    <a class = "li-title">
                                        <span>–≠–∫—Å–ø–æ—Ä—Ç</span>
                                    </a>
                                </li>
                                <li id = "toTicketsBtn">
                                    <img src="{{ url_for('static', filename='img/icon_print_file.png') }}" alt="">
                                    <a class = "li-title">
                                        <span>–ö–≤–∏—Ç–∞–Ω—Ü–∏–∏</span>
                                    </a>
                                </li>
                            </div>
                            <a class="functions_menu_name">
                                –ü—Ä–æ—á–µ–µ
                            </a>
                        </section>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <div class="report-area">
        {%if report%}
        <table class="table-report-area">
            <thead class="table-title">
                <tr>
                    <th></th>
                    <th style = "white-space: nowrap;"></th>
                    <th class="resizable" style="white-space: nowrap; min-width: 320px;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è<div class="resizer"></div></th>
                    <th class="resizable" style="min-width: 120px;">–û–ö–ü–û<div class="resizer"></div></th>
                    <th class="resizable" style="min-width: 80px;">–ì–æ–¥<div class="resizer"></div></th>
                    <th class="resizable" style="min-width: 80px;">–ö–≤–∞—Ä—Ç–∞–ª<div class="resizer"></div></th>
                    <th class="resizable" style="min-width: 140px;">–°—Ç–∞—Ç—É—Å<div class="resizer"></div></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for row in report %}
                <tr class="report_row" data-id="{{ row.id }}" data-version-id="{{ row.versions[0].id }}">
                    <td></td>
                    <td style="padding: 4px;">
                        <button class="open-report-btn" onclick="window.location.href='/report-area/fuel/{{row.versions[0].id}}'">  
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            <span>–ü—Ä–æ—Å–º–æ—Ç—Ä</span>
                        </button>
                    </td>
                    <td style="display: none;">
                        <input type="text" id="report_id" value="{{ row.id }}" readonly>
                    </td>
                    <td>
                        <input type="text" id="report_organization_name" value="{{ row.organization.full_name }}" readonly>
                    </td>
                    <td>
                        <input type="text" id="report_okpo" value="{{ row.okpo }}" readonly>
                    </td>
                    <td>
                        <input type="text" id="report_year" value="{{ row.year }}" readonly>
                    </td>
                    <td>
                        <input type="text" id="report_quarter" value="{{ row.quarter }}" readonly>
                    </td>
                    
                    {% set version = row.versions[0] if row.versions else None %}
                    
                    {% if version %}
                        <td>
                            {% if version.status == '–ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ–π–¥–µ–Ω' %}
                                <span class="status-badge status-control">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                    </svg>
                                    <span>–ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ–π–¥–µ–Ω</span>
                                </span>
                                
                            {% elif version.status == '–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ'%}
                                <span class="status-badge status-agreed">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 3v1.5M3 21v-6m0 0l2.77-.693a9 9 0 016.208.682l.108.054a9 9 0 006.086.71l3.114-.732a48.524 48.524 0 01-.005-10.499l-3.11.732a9 9 0 01-6.085-.711l-.108-.054a9 9 0 00-6.208-.682L3 4.5M3 15V4.5" />
                                    </svg>
                                    <span>–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ</span>
                                </span>      
                                
                            {% elif version.status == '–û–¥–æ–±—Ä–µ–Ω' %}
                                <span class="status-badge status-approved">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span>–û–¥–æ–±—Ä–µ–Ω</span>
                                </span>      
                                
                                
                            {% elif version.status == '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω' %}
                                <span class="status-badge status-pending">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span>–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</span>
                                </span>
                                
                            {% elif version.status == '–ï—Å—Ç—å –∑–∞–º–µ—á–∞–Ω–∏—è' %}
                                <span class="status-badge status-warning">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                                    </svg>
                                    <span>–ï—Å—Ç—å –∑–∞–º–µ—á–∞–Ω–∏—è</span>
                                </span>
                                
                            {% elif version.status == '–ì–æ—Ç–æ–≤ –∫ —É–¥–∞–ª–µ–Ω–∏—é' %}
                                <span class="status-badge status-delete">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                    </svg>
                                    <span>–ì–æ—Ç–æ–≤ –∫ —É–¥–∞–ª–µ–Ω–∏—é</span>
                                </span>
                                
                            {% elif version.status == '–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ' %}
                                <span class="status-badge status-draft">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                                    </svg>
                                    <span>–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ</span>
                                </span>
                                
                            {% else %}
                                <span class="status-badge status-default">
                                    <span>{{ version.status }}</span>
                                </span>
                            {% endif %}
                        </td>
                    {% else %}
                        <td></td>
                    {% endif %}
                    <td></td>
                </tr>
                {% endfor %}
 
            </tbody>
        </table>
        {%else%}
        <div class="empty-state">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
            </svg>
            <h3>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤</h3>
            <p>–£ –≤–∞—Å –ø–æ–∫–∞ —á—Ç–æ –Ω–µ—Ç –æ—Ç—á–µ—Ç–æ–≤. –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É, —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –æ—Ç—á–µ—Ç.</p>
        </div>
        {%endif%}
    </div>
</div>

<div id="add_report_modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="change-position">–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞</h3>
            <img src="/static/img/Close.svg" id="close_add_report_modal" class="close" alt="">
        </div>
        <div class="answer-highlight-second">
            <div class="highlight-icon">üí°</div>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π <strong>–æ—Ç—á–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥</strong>.</p>
        </div>
        <form method="POST" action="/create-new-report">
            <input type="hidden" name="modal_add_year" id="selected-year-add" value="{{previous_year}}">
            <input type="hidden" name="modal_add_quarter" id="selected-quarter-add" value="{{previous_quarter}}">

            <div class="period-selector-advanced" id="add-period-selector">
                <div class="selector-card">
                    <div class="selector-grid">
                        <div class="year-wheel">
                            <button type="button" class="year-arrow up-arrow">‚Üë</button>
                            <div class="year-display"></div>
                            <button type="button" class="year-arrow down-arrow">‚Üì</button>
                        </div>
                        
                        <div class="quarter-grid">
                            <button type="button" class="q-cell" data-q="1">
                                <span class="q-number">1 –∫–≤.</span>
                                <span class="q-months">–Ø–Ω–≤-–ú–∞—Ä</span>
                            </button>
                            <button type="button" class="q-cell" data-q="2">
                                <span class="q-number">2 –∫–≤.</span>
                                <span class="q-months">–ê–ø—Ä-–ò—é–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="3">
                                <span class="q-number">3 –∫–≤.</span>
                                <span class="q-months">–ò—é–ª-–°–µ–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="4">
                                <span class="q-number">4 –∫–≤.</span>
                                <span class="q-months">–û–∫—Ç-–î–µ–∫</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="selector-info-add" class="period-info"></div>
            
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="model_but_area right">
                <button type="submit" class="blue_btn">
                    <img src="/static/img/Add.svg" alt="" class="button-icon">
                    <span>–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç</span>
                </button>
            </div>
        </form> 
    </div>
</div>

<div id="change_period_report_modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="change-position">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –æ—Ç—á–µ—Ç–∞</h3>
            <img src="{{ url_for('static', filename='img/Close.svg')}}" class="close" id="close_change_period_report_modal" alt="">
        </div>
       
        <div class="answer-highlight-second">
            <div class="highlight-icon">üí°</div>    
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π <strong>–æ—Ç—á–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥</strong>.</p>
        </div>
        <form method="POST" action="/change-period-report">
            <input type="hidden" name="modal_change_report_year" id="selected-year-change" value="">
            <input type="hidden" name="modal_change_report_quarter" id="selected-quarter-change" value="">
            <input type="hidden" name="modal_change_report_id" id="modal_change_report_id"  readonly>

            <div class="period-selector-advanced" id="change-period-selector">
                <div class="selector-card">
                    <div class="selector-grid">
                        <div class="year-wheel">
                            <button type="button" class="year-arrow up-arrow">‚Üë</button>
                            <div class="year-display"></div>
                            <button type="button" class="year-arrow down-arrow">‚Üì</button>
                        </div>
                        
                        <div class="quarter-grid">
                            <button type="button" class="q-cell" data-q="1">
                                <span class="q-number">1 –∫–≤.</span>
                                <span class="q-months">–Ø–Ω–≤-–ú–∞—Ä</span>
                            </button>
                            <button type="button" class="q-cell" data-q="2">
                                <span class="q-number">2 –∫–≤.</span>
                                <span class="q-months">–ê–ø—Ä-–ò—é–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="3">
                                <span class="q-number">3 –∫–≤.</span>
                                <span class="q-months">–ò—é–ª-–°–µ–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="4">
                                <span class="q-number">4 –∫–≤.</span>
                                <span class="q-months">–û–∫—Ç-–î–µ–∫</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="selector-info-change" class="period-info"></div>

            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="model_but_area right">
                <button type="submit" class="blue_btn">
                    <img src="/static/img/Edit.svg" alt="" class="button-icon">
                    <span>–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>
                </button>
            </div>
        </form> 
    </div>
</div>

<div id="copy_report_modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="change-position">–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞</h3>
            <img src="{{ url_for('static', filename='img/Close.svg')}}" class="close" alt="">
        </div>
        <div class="answer-highlight-second" style="max-width: 550px;">
            <div class="highlight-icon">üí°</div>
            <p>
                <strong>–û–±—ã—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</strong> ‚Äî —Å–æ–∑–¥–∞–µ—Ç —Ç–æ—á–Ω—É—é –∫–æ–ø–∏—é –æ—Ç—á–µ—Ç–∞ —Å–æ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏.<br>
                <strong>–ù–µ–ø–æ–ª–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</strong> ‚Äî –∫–æ–ø–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∏–¥—ã –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –±–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
            </p>
        </div>
        
        <form method="POST" id="copy-report-form">
            <input type="hidden" name="modal_copy_report_year" id="selected-year-copy">
            <input type="hidden" name="modal_copy_report_quarter" id="selected-quarter-copy">
            <input type="hidden" name="modal_copy_report_id" id="modal_copy_report_id" readonly>
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <div class="period-selector-advanced" id="copy-period-selector">
                <div class="selector-card">
                    <div class="selector-grid">
                        <div class="year-wheel">
                            <button type="button" class="year-arrow up-arrow">‚Üë</button>
                            <div class="year-display"></div>
                            <button type="button" class="year-arrow down-arrow">‚Üì</button>
                        </div>
                        
                        <div class="quarter-grid">
                            <button type="button" class="q-cell" data-q="1">
                                <span class="q-number">1 –∫–≤.</span>
                                <span class="q-months">–Ø–Ω–≤-–ú–∞—Ä</span>
                            </button>
                            <button type="button" class="q-cell" data-q="2">
                                <span class="q-number">2 –∫–≤.</span>
                                <span class="q-months">–ê–ø—Ä-–ò—é–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="3">
                                <span class="q-number">3 –∫–≤.</span>
                                <span class="q-months">–ò—é–ª-–°–µ–Ω</span>
                            </button>
                            <button type="button" class="q-cell" data-q="4">
                                <span class="q-number">4 –∫–≤.</span>
                                <span class="q-months">–û–∫—Ç-–î–µ–∫</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="selector-info-copy" class="period-info"></div>

            <div class="model_but_area">
                <button type="submit" formaction="/copy-full-report" class="blue_btn">
                    <img src="/static/img/Copy.svg" alt="" class="button-icon">
                    <span>–û–±—ã—á–Ω–∞—è –∫–æ–ø–∏—è</span>
                </button>
                <button type="submit" formaction="/copy-structure-report" class="invisible-btn">
                    <span>–ù–µ–ø–æ–ª–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                </button>
            </div>
        </form> 
    </div>
</div>

<div id="contextMenu_report" class="white-panel">
    <button id = "link_change_report">
        <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
        </svg>
        <span>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥</span>
    </button>
    <button id = "link_coppy_report">
        <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
        </svg>
        <span>–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞</span>
    </button>
    <form id="deleteReport" method="POST" action="/delete-report/">
        <button type="submit" id="del_reportButton">
            <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
            <span>–£–¥–∞–ª–∏—Ç—å</span>
        </button>
    </form>
</div>
{% endblock %}
