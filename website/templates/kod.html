{% extends "base.html" %}
{% block title %}–ö–æ–¥ –∏–Ω–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - ErespondentN{% endblock %}
{% block content %}
<div class="blurred-background"></div>
<div class="page_log_reg">
    <div class="log_reg_contener">
        <div class="log_reg_img"></div>
    
        <div class="log_reg_form"> 
            <form action="/kod" method="POST">
                <div class="link_cont" style = "margin-bottom: 25px;">
                    <a onclick="window.location.href='/login'" class = "active" style="margin-right: 19px;">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</a>
                </div>
                <div class="answer-highlight-second" style = "max-width: 450px;">
                    <div class="highlight-icon">üí°</div>
                    <p>–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É. –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –º–æ–∂–µ—Ç —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ–∫—É–Ω–¥ –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏–Ω—É—Ç. </p>
                </div>
                <div class="authorization_data">
                    <div class="activation_code_container">
                        {% for i in range(5) %}
                        <input
                            type="text"
                            name="activation_code_{{ i }}"
                            maxlength="1"
                            class="activation_code_input"
                            required
                        />
                        {% endfor %}
                    </div>
                </div>
                
                <div class="log_buttons_area">
                    <button type="submit" class="submit_button blue_button">         
                        <img src="/static/img/Send.svg" alt="" class="button-icon">
                        <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</span>         
                    </button>
                </div>
            </form>
        
            <div class = "forgot_cont">
                <button class = 'relod_button' id = "relod_button_kod" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—â—ë —Ä–∞–∑?</button>
            </div>
            
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const inputs = document.querySelectorAll('.activation_code_input');
        inputs.forEach((input, index) => {
            input.addEventListener('input', () => {
                if (input.value && index < inputs.length - 1) {
                    inputs[index + 1].focus();
                }
                else if (!input.value && index > 0) {
                    inputs[index - 1].focus();
                }
            });
    
            input.addEventListener('keydown', (e) => {
                if (e.key === "Backspace" && index > 0 && !input.value) {
                    inputs[index - 1].focus();
                }
            });
        });
    
        inputs[0].addEventListener('paste', (e) => {
            e.preventDefault();
            const pasteData = e.clipboardData.getData('text');
        
            pasteData.split('').forEach((char, i) => {
                if (i < inputs.length) {
                    inputs[i].value = char;
                }
            });

            inputs[Math.min(pasteData.length - 1, inputs.length - 1)].focus();
        });
    });

    document.addEventListener('DOMContentLoaded', () => {
        const resendButton = document.getElementById('relod_button_kod');
    
        resendButton.addEventListener('click', (e) => {
            e.preventDefault();
            
            fetch('/resend-code', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert(data.message); 
                    resendButton.disabled = true; 
                    
                    setTimeout(() => {
                        resendButton.disabled = false;
                    }, 30000); 
                } else {
                    alert(data.message); 
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –ø–æ–∑–∂–µ.');
            });
        });
    });
</script>
{% endblock %}
