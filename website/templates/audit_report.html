{% extends "base.html" %}
{% block title %}Аудит отчета - ErespondentN{% endblock %}
{% block content %}
<div class = "report-area_page">
    <div class = "report-area_menu">
        <div class="report-area_podmenu">
            <div class="content-podmenu">
                <nav>
                    <ul>          
                        <section>
                            <div class = "functions_menu">                  
                                <li id = "addCommentLink">
                                    <img src="{{ url_for('static', filename='img/icon_send.png')}}" alt="">
                                    <a>Отправить</a>
                                </li>                                  
                            </div>  
                            <a class="functions_menu_name">
                                Сообщение
                            </a>
                        </section>
                        <section>
                            <div class = "functions_menu">
                                <li data-section="fuel_section_link" class = "activefunctions_menu">         
                                    <img src="{{ url_for('static', filename='img/Toplivo.png')}}" alt="">
                                    <a>Топливо</a>   
                                </li>
                                <li data-section="heat_section_link" >                      
                                    <img src="{{ url_for('static', filename='img/Teplo.png')}}" alt="">
                                    <a>Тепло</a>
                                </li>
                                <li data-section="electro_section_link">           
                                    <img src="{{ url_for('static', filename='img/Electro.png')}}" alt="">
                                    <a>Электро</a>   
                                </li>  
                            </div>
                            <a class="functions_menu_name">
                                Раздел
                            </a>
                        </section>
                        <section>
                            <div class = "functions_menu">  
                                <form style = "display: none;" id = "export-table-form" action="/export-table" method="post">
                                    <input type = "hidden" name = "version_id" value = "{{current_version.id}}" readonly>
                                    <input type = "hidden" name = "numb_section" value = "1" readonly>
                                </form>
                                <li id = "export-table-btn">           
                                    <img src="{{ url_for('static', filename='img/icon_excel.png')}}" alt="">
                                    <a>Экспорт</a>   
                                </li>                         
                                <li onclick="sortTable()"  title = 'Сортировка по [Б]'>            
                                    <img src="{{ url_for('static', filename='img/icon_sort.png')}}" alt="">
                                    <a>Сортировка</a>     
                                </li>  
                            </div>  
                            <a class="functions_menu_name">
                                Таблица
                            </a>
                        </section>
                        <section>
                            <div class="functions_menu">
                                <li id = "showCommentsLink">           
                                    <img src="{{ url_for('static', filename='img/icon_messages.png')}}" alt="">
                                    <a>Сообщения</a>   
                                </li>
                            </div>
                            <a class="functions_menu_name">
                               Доп. инф.
                            </a>
                        </section>
                    </ul>
                </nav>
            </div>
        </div> 
    </div>
    <div class = "rotation-fromareas">
        <div class = "rotation-fromareas_info"  style = "margin: 20px 30px;"> 
            <span>
                <a class = "hover_a" href="javascript:void(0)" onclick="smartBack()">Вернуться к отчетам</a>
            </span>
            <span> 
                <img src="{{ url_for('static', filename='img/icon_arroy.png')}}" alt="">
            </span>
            <span>
                <a>Отчет № {{id_report}}</a>
            </span>
        </div>
    </div>
    <div class="report-area">
        <div id="fuel_section_table"> 
            <table class = "table_report-area">
                <thead class="order-table_titels">
                    <tr>
                        <th class="resizable" rowspan="2"></th>
                        <th class="resizable" style = "white-space: nowrap;" rowspan="2">Наименование вида продукции (работ услуг)<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2" style = "white-space: nowrap;">Код строки<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2" style = "white-space: nowrap;">Код по ОКЭД<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2">Единица измерения<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2">Произведено продукции (работ, услуг) за отчетный период<div class="resizer"></div></th>
                        <th class="resizable" colspan="2">Израсходовано на единицу продукции (работы, услуги) за отчетный период, кг у.т.<div class="resizer"></div></th>
                        <th class="resizable" colspan="3">Израсходовано на всю произведенную продукцию (работу, услугу) за отчетный период, т у.т.<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2">Примечание<div class="resizer"></div></th>
                        <th rowspan="2"></th>
                    </tr>
                    <tr>
                        <th class="resizable">по утвержденной норме (предельному уровню)<div class="resizer"></div></th>
                        <th class="resizable">фактически<div class="resizer"></div></th>
                        <th class="resizable">по утвержденной норме (предельному уровню)<div class="resizer"></div></th>
                        <th class="resizable">фактически<div class="resizer"></div></th>
                        <th class="resizable" style = "width: 80px;">Экономия(-), перерасход(+)<div class="resizer"></div></th> 
                    </tr>
                    <tr>
                        <th></th>
                        <th class="resizable">A<div class="resizer"></div></th>
                        <th class="resizable">Б<div class="resizer"></div></th>
                        <th class="resizable">В<div class="resizer"></div></th>
                        <th class="resizable">Г<div class="resizer"></div></th>
                        <th class="resizable">1<div class="resizer"></div></th>
                        <th class="resizable">2<div class="resizer"></div></th>
                        <th class="resizable">3<div class="resizer"></div></th>
                        <th class="resizable">4<div class="resizer"></div></th>
                        <th class="resizable">5<div class="resizer"></div></th>
                        <th class="resizable">6<div class="resizer"></div></th>
                        <th class="resizable">7<div class="resizer"></div></th>
                        <th rowspan="2"></th>
                    </tr>
                </thead>
                <tbody>
                    {%if sections_fuel %}
                        {% for row in sections_fuel %}
                        <tr class = "section_row" data-id="{{ row.id }}" >
                            <td>
                                <input 
                                    type = "hidden" 
                                    name = "id_section" 
                                    value = "{{ row.id }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input 
                                    class = "product-name_fuel" 
                                    type = "text" 
                                    value = "{{ row.product.NameProduct }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input 
                                    type = "text"
                                    name = "product-cod_fuel"
                                    value = "{{ row.code_product }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input 
                                    name = "Oked_fuel" 
                                    type = "text"
                                    value = "{{ row.Oked }}" 
                                    readonly
                                >
                            </td>
                            <td> 
                                <input 
                                    style = "white-space: nowrap; text-align: left;"
                                    type = "text" 
                                    name = "" 
                                    value = "{{ row.product.unit.NameUnit }}" 
                                    readonly
                                >
                            </td> 
                            <td>
                                <input 
                                    name = "produced_fuel" 
                                    type = "text"
                                    value = "{{ row.produced }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input 
                                    name = "Consumed_Quota_fuel" 
                                    type = "text"
                                    value = "{{ row.Consumed_Quota }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input 
                                    name = "Consumed_Fact_fuel" 
                                    type = "text"
                                    value = "{{ row.Consumed_Fact }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input 
                                    name = "Consumed_Total_Quota_fuel" 
                                    type = "text"
                                    value = "{{ row.Consumed_Total_Quota }}" 
                                    readonly
                                >
                            </td>
                            <td>     
                                <input 
                                    name = "Consumed_Total_Fact_fuel" 
                                    type = "text"
                                    value = "{{ row.Consumed_Total_Fact }}" 
                                    readonly
                                >
                            </td>
                            {% if row.total_differents is not none and (row.total_differents < 0.0 or row.total_differents == 0.00) %}
                                <td style="background-color: #a2ff77;">
                                    <input 
                                        style="background-color: #a2ff77; color: black;" 
                                        name="row_total_differents" 
                                        type = "text"
                                        value="{{ row.total_differents }}" 
                                        readonly
                                    >
                                </td>
                            {%else%}
                                <td style="background-color: #ff7676;">
                                    <input 
                                        style="background-color: #ff7676; 
                                        color: black;" 
                                        type = "text"
                                        name="row_total_differents" 
                                        value="{{ row.total_differents }}" 
                                        readonly
                                    >
                                </td>
                            {%endif%}
                            <td> 
                                <input 
                                    name = "note_fuel" 
                                    type = "text"
                                    value = "{{ row.note }}" 
                                    readonly
                                >
                            </td>     
                            <td colspan="2"></td>      
                        </tr>   
                        {%endfor%}
                    {%else%}
                        <tr>
                            <td></td>
                            <td style = "height: 24px;" colspan="12">
                                <input type = "text"  value = "Пусто" readonly>
                            </td>
                        </tr>
                    {%endif%}
                </tbody>
            </table>        
        </div>
        <div id="heat_section_table" style="display: none;">
            <table class = "table_report-area">
                <thead class="order-table_titels">
                    <tr>
                        <th class="resizable" rowspan="2"></th>
                        <th class="resizable" style = "white-space: nowrap;" rowspan="2">Наименование вида продукции (работ услуг)<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2" style = "white-space: nowrap;">Код строки<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2" style = "white-space: nowrap;">Код по ОКЭД<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2">Единица измерения<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2">Произведено продукции (работ, услуг) за отчетный период<div class="resizer"></div></th>
                        <th class="resizable" colspan="2">Израсходовано на единицу продукции (работы, услуги) за отчетный период, Мкал<div class="resizer"></div></th>
                        <th class="resizable" colspan="3">Израсходовано на всю произведенную продукцию (работу, услугу) за отчетный период, Гкал<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2">Примечание<div class="resizer"></div></th>
                        <th rowspan="2"></th>
                    </tr>
                    <tr>
                        <th class="resizable">по утвержденной норме (предельному уровню)<div class="resizer"></div></th>
                        <th class="resizable">фактически<div class="resizer"></div></th>
                        <th class="resizable">по утвержденной норме (предельному уровню)<div class="resizer"></div></th>
                        <th class="resizable">фактически<div class="resizer"></div></th>
                        <th class="resizable" style = "width: 80px;">Экономия(-), перерасход(+)<div class="resizer"></div></th> 
                    </tr>
                    <tr>
                        <th></th>
                        <th class="resizable">A<div class="resizer"></div></th>
                        <th class="resizable">Б<div class="resizer"></div></th>
                        <th class="resizable">В<div class="resizer"></div></th>
                        <th class="resizable">Г<div class="resizer"></div></th>
                        <th class="resizable">1<div class="resizer"></div></th>
                        <th class="resizable">2<div class="resizer"></div></th>
                        <th class="resizable">3<div class="resizer"></div></th>
                        <th class="resizable">4<div class="resizer"></div></th>
                        <th class="resizable">5<div class="resizer"></div></th>
                        <th class="resizable">6<div class="resizer"></div></th>
                        <th class="resizable">7<div class="resizer"></div></th>
                        <th rowspan="2"></th>
                    </tr>
                </thead>
                <tbody>
                    {%if sections_heat%}
                        {% for row in sections_heat %}
                        <tr class = "section_row" data-id="{{ row.id }}" >
                            <td>
                                <input 
                                    type = "hidden" 
                                    name = "id_section" 
                                    value = "{{ row.id }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input type = "text"
                                    class = "product-name_fuel" 
                                    type = "text" 
                                    value = "{{ row.product.NameProduct }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input type = "text"
                                    name = "code_product" 
                                    value = "{{ row.code_product }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input type = "text"
                                    name = "Oked_fuel" 
                                    value = "{{ row.Oked }}" 
                                    readonly
                                >
                            </td>
                            <td> 
                                <input type = "text"
                                    style = "white-space: nowrap; text-align: left;" 
                                    name = "" 
                                    value = "{{ row.product.unit.NameUnit }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input type = "text"
                                    name = "produced_fuel" 
                                    value = "{{ row.produced }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input type = "text"
                                    name = "Consumed_Quota_fuel" 
                                    value = "{{ row.Consumed_Quota }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input type = "text"
                                    name = "Consumed_Fact_fuel" 
                                    value = "{{ row.Consumed_Fact }}" 
                                    readonly
                                >
                            </td>
                            <td>
                                <input type = "text"
                                    name = "Consumed_Total_Quota_fuel" 
                                    value = "{{ row.Consumed_Total_Quota }}" 
                                    readonly
                                >
                            </td>
                            <td>     
                                <input type = "text"
                                    name = "Consumed_Total_Fact_fuel" 
                                    value = "{{ row.Consumed_Total_Fact }}" 
                                    readonly
                                >
                            </td>
                            {% if row.total_differents is not none and (row.total_differents < 0.0 or row.total_differents == 0.00) %}
                                <td style="background-color: #a2ff77;">
                                    <input type = "text"
                                        style="background-color: #a2ff77; color: black;" 
                                        name="row_total_differents" 
                                        value="{{ row.total_differents }}" 
                                        readonly
                                    >
                                </td>
                            {%else%}
                                <td style="background-color: #ff7676;">
                                    <input type = "text"
                                        style="background-color: #ff7676; 
                                        color: black;" 
                                        name="row_total_differents" 
                                        value="{{ row.total_differents }}" 
                                        readonly
                                    >
                                </td>
                            {%endif%}
                            <td> 
                                <input type = "text"
                                    name = "note_fuel" 
                                    value = "{{ row.note }}" 
                                    readonly
                                >
                            </td>  
                            <td colspan="2"></td>          
                        </tr>   
                        {%endfor%}
                    {%else%}
                        <tr>
                            <td></td>
                            <td style = "height: 24px;" colspan="12">
                                <input type = "text"  value = "Пусто" readonly>
                            </td>
                        </tr>
                    {%endif%}
                </tbody>
            </table>        
        </div>
        <div id="electro_section_table" style="display: none;">
            <table class = "table_report-area">
                <thead class="order-table_titels">
                    <tr>
                        <th class="resizable" rowspan="2"></th>
                        <th class="resizable" style="white-space: nowrap;" rowspan="2">Наименование вида продукции (работ услуг)<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2" style = "white-space: nowrap;">Код строки<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2" style = "white-space: nowrap;">Код по ОКЭД<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2">Единица измерения<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2">Произведено продукции (работ, услуг) за отчетный период<div class="resizer"></div></th>
                        <th class="resizable" colspan="2">Израсходовано на единицу продукции (работы, услуги) за отчетный период, кВтч<div class="resizer"></div></th>
                        <th class="resizable" colspan="3">Израсходовано на всю произведенную продукцию (работу, услугу) за отчетный период, тыс.кВтч<div class="resizer"></div></th>
                        <th class="resizable" rowspan="2">Примечание<div class="resizer"></div></th>
                        <th rowspan="2"></th>
                    </tr>
                    <tr>
                        <th class="resizable">по утвержденной норме (предельному уровню)<div class="resizer"></div></th>
                        <th class="resizable">фактически<div class="resizer"></div></th>
                        <th class="resizable">по утвержденной норме (предельному уровню)<div class="resizer"></div></th>
                        <th class="resizable">фактически<div class="resizer"></div></th>
                        <th class="resizable" style = "width: 80px;">Экономия(-), перерасход(+)<div class="resizer"></div></th> 
                    </tr>
                    <tr>
                        <th></th>
                        <th class="resizable">A<div class="resizer"></div></th>
                        <th class="resizable">Б<div class="resizer"></div></th>
                        <th class="resizable">В<div class="resizer"></div></th>
                        <th class="resizable">Г<div class="resizer"></div></th>
                        <th class="resizable">1<div class="resizer"></div></th>
                        <th class="resizable">2<div class="resizer"></div></th>
                        <th class="resizable">3<div class="resizer"></div></th>
                        <th class="resizable">4<div class="resizer"></div></th>
                        <th class="resizable">5<div class="resizer"></div></th>
                        <th class="resizable">6<div class="resizer"></div></th>
                        <th class="resizable">7<div class="resizer"></div></th>
                        <th rowspan="2"></th>
                    </tr>
                </thead>
                <tbody>
                    {%if sections_electro%}
                        {% for row in sections_electro %}
                        <tr class = "section_row" data-id="{{ row.id }}" >
                            <td>
                                <input type = "hidden" name = "id_section" value = "{{ row.id }}" readonly></td>
                            <td>
                                <input type = "text" class = "product-name_fuel" type = "text" value = "{{ row.product.NameProduct }}" readonly>
                            </td>
                            <td>
                                <input type = "text"name = "code_product" value = "{{ row.code_product }}" readonly>
                            </td>
                            <td>
                                <input type = "text" name = "Oked_fuel" value = "{{ row.Oked }}" readonly>
                            </td>
                            <td> 
                                <input type = "text" style = "white-space: nowrap; text-align: left;" name = "" value = "{{ row.product.unit.NameUnit }}" readonly>
                            </td> 
                            <td>
                                <input type = "text" name = "produced_fuel" value = "{{ row.produced }}" readonly>
                            </td>
                            <td>
                                <input type = "text" name = "Consumed_Quota_fuel" value = "{{ row.Consumed_Quota }}" readonly>
                            </td>
                            <td>
                                <input type = "text" name = "Consumed_Fact_fuel" value = "{{ row.Consumed_Fact }}" readonly>
                            </td>
                            <td>
                                <input type = "text" name = "Consumed_Total_Quota_fuel" value = "{{ row.Consumed_Total_Quota }}" readonly>
                            </td>
                            <td>     
                                <input type = "text" name = "Consumed_Total_Fact_fuel" value = "{{ row.Consumed_Total_Fact }}" readonly>
                            </td>
                            {% if row.total_differents is not none and (row.total_differents < 0.0 or row.total_differents == 0.00) %}
                                <td style="background-color: #a2ff77;">
                                    <input type = "text" style="background-color: #a2ff77; color: black;" name="row_total_differents"  value="{{ row.total_differents }}" readonly>
                                </td>
                            {%else%}
                                <td style="background-color: #ff7676;">
                                    <input type = "text" style="background-color: #ff7676; color: black;" name="row_total_differents"  value="{{ row.total_differents }}" readonly>
                                </td>
                            {%endif%}
                            <td> 
                                <input type = "text" name = "note_fuel" value = "{{ row.note }}" readonly>
                            </td>     
                            <td colspan="2"></td>       
                        </tr>   
                        {%endfor%}
                    {%else%}
                        <tr>
                            <td></td>
                            <td style = "height: 24px;" colspan="12">
                                <input type = "text"  value = "Пусто" readonly>
                            </td>
                        </tr>
                    {%endif%}
                </tbody>
            </table>        
        </div>
    </div>
    <div class = "report_infoUnder"> 
        <table>
            <tr>
                <td>Наименование предприятия</td>
                <td>
                    <input 
                   
                        type="text"
                        value = "{{current_report.organization.full_name}}"
                        title = "{{current_report.organization.full_name}}"
                        readonly
                    >
                </td>
            </tr>
            <tr>
                <td>ОКПО</td>
                <td>
                    <input 
                        type="text" 
                        value = "{{current_report.okpo}}"
                        title = "{{current_report.okpo}}"
                        readonly
                    >
                </td>
            </tr>
            <tr>
                <td>Год</td>
                <td>
                    <input 
                        type="text" 
                        value = "{{current_report.year}}"
                        title = "{{current_report.year}}"
                        readonly
                    >
                </td>
            </tr>
            <tr>
                <td>Квартал</td>
                <td>
                    <input 
                        type="text" 
                        value = "{{current_report.quarter}}"
                        title = "{{current_report.quarter}}"
                        readonly
                    >
                </td>
            </tr>
        </table>
    </div>
</div>
<div id="RespondentModal" class="modal">
    <div class="modal-content">
        <div class = "modal-header">
            <h3 class = "change-position">Респондент</h3>
            <a class="close" id = "CloseRespondent">&times;</a>
        </div>
        <div class="modal-middle-text">
            <div>Информация об респонденте.</div>
        </div>
        <div class="spravochniki_area">
            <table class = "modal_table">
                <tr>
                    <td>Респондент</td>
                    <td>    
                        <input 
                            type="text" 
                            value = "{{current_version.fio}}"
                            readonly
                        >
                    </td>
                </tr>
                <tr>
                    <td>Номер телефона</td>
                    <td>
                        <input                 
                            type="text"
                            value = "{{current_version.telephone}}"
                            readonly
                        >
                    </td>
                </tr>
                <tr>
                    <td>E-mail</td>
                    <td>
                        <input                 
                            type="text"
                            value = "{{current_version.email}}"
                            readonly
                        >
                    </td>
                </tr>
            </table>       
        </div>
    </div>
</div>
<div id="addCommentModal" class="modal">
    <div class="modal-content">
        <div class = "modal-header">
            <h3 class = "change-position">Сообщение респонденту</h3>
            <a class="close" id = "CloseaddComment">&times;</a>
        </div>
        <div class="modal-middle-text">
            <div>Если присутствует <strong>ошибка</strong> в отчете, <strong>укажите</strong> её.</div>
        </div>
        <div class="spravochniki_area">
            <form method="POST" action="/send-comment">
                <table class = "modal_table">
                    <tr>
                        <td>E-mail</td>
                        <td>
                            <input                 
                                type="text"
                                name = "resp_email"
                                value = "{{current_version.email}}"
                                readonly
                            >
                        </td>
                    </tr>
                    <tr>
                        <td>ФИО</td>
                        <td>
                            <input                 
                                type="text"
                                value = "{{current_version.fio}}"
                                readonly
                            >
                        </td>
       
                    <tr>
                    <tr>
                        <td>Телефон</td>
                        <td>
                            <input                 
                                type="text"
                                value = "{{current_version.telephone}}"
                                readonly
                            >
                        </td>
                    </tr>
                        <td>Текст</td>
                        <td style="height: 94px;">
                            <textarea name="text" maxlength="399" required></textarea>
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td style = "display: flex; justify-content: end; padding: 15px; ">
                            <button type="submit" class="blue_button report-submit" >Отправить</button>
                        </td>
                    </tr>
                </table>  
                <input type = "hidden" name = "version_id" value = "{{current_version.id}}">
            </form>
        </div>
    </div>
</div>
<div id="showCommentsModal" class="modal">
    <div class="modal-content">
        <div class = "modal-header">
            <h3 class = "change-position">Сообщения</h3>
            <a class="close" id = "CloseshowComments">&times;</a>
        </div>
        <div class="modal-middle-text">
            <div>Сообщения <strong>респонденту</strong> об результатах проверки <strong>текущего</strong> отчета.</div>
        </div>
        <div class="spravochniki_area">
            <div class="telegram-chat">
                {% if tickets %}
                    {% for row in tickets %}
                        <div class="telegram-message">
                            <div class="message-bubble">
                                <div class="message-text">
                                    {{ row.note }}
                                </div>
                                <div class="message-meta">
                                    <span class="message-time">{{ row.begin_time }}</span>
                                    <span class="message-status">
                                        <input type="checkbox" {% if row.luck %} checked {% endif %} onclick="return false;">
                                    </span>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="telegram-message system-message">
                        Сообщений пока что нет
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var currentStatus = "{{ current_version.status }}";
    
        if (currentStatus !== 'Отправлен') {
            updateauditVeiwButtonStyle(false);
        } else {
            updateauditVeiwButtonStyle(true);
        }
    });

    function updateauditVeiwButtonStyle(activecommentLink) {
        var addCommentLink = document.getElementById('addCommentLink');
        
        if (activecommentLink) {
            addCommentLink.style.opacity = '1';
            addCommentLink.style.cursor = 'pointer';
            addCommentLink.querySelector('img').style.filter = 'none';
            addCommentLink.querySelector('a').style.filter = 'none';
        } else {
            addCommentLink.style.opacity = '0.5';
            addCommentLink.style.cursor = 'not-allowed';
            addCommentLink.querySelector('img').style.filter = 'grayscale(100%)';
            addCommentLink.querySelector('a').style.filter = 'grayscale(100%)';
        }
    }

    function smartBack() {
        const ref = document.referrer;
        if (ref.includes('modal=addCommentModal') && history.length > 2) {
            history.go(-2);
        } else {
            history.back();
        }
    }

</script>

<script src="{{ url_for('static', filename='js/audit_report.js') }}"></script>
{% endblock %}